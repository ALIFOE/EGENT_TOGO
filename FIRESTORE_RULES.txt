rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    // ✅ DONNÉES PUBLIQUES - Lecture seule, édition admin uniquement
    match /products/{document=**} {
      allow read: if true;  // Public peut lire les produits
      allow create, update, delete: if request.auth != null;  // Admin authentifié seulement
    }
    match /articles/{document=**} {
      allow read: if true;  // Public peut lire
      allow create, update, delete: if request.auth != null;  // Admin authentifié seulement
    }
    match /gallery/{document=**} {
      allow read: if true;  // Public peut lire
      allow create, update, delete: if request.auth != null;  // Admin authentifié seulement
    }
    match /projects/{document=**} {
      allow read: if true;  // Public peut lire
      allow create, update, delete: if request.auth != null;  // Admin authentifié seulement
    }
    
    // ⚠️ FORMULAIRES DE CONTACT - Public peut créer, admin lit/modère
    // Validation : max 5KB, champs obligatoires
    match /contact_forms/{document=**} {
      allow create: if request.resource.size < 5120 &&
                       request.resource.data.keys().hasAll(['name', 'email', 'message', 'createdAt']) &&
                       request.resource.data.name is string &&
                       request.resource.data.email is string &&
                       request.resource.data.message is string &&
                       request.resource.data.name.size() > 0 &&
                       request.resource.data.email.size() > 5 &&
                       request.resource.data.message.size() > 10;
      allow read, update, delete: if request.auth != null;  // Admin authentifié seulement
    }
    
    // ⚠️ DEVIS - Public peut créer avec validation, admin modère
    // Validation : max 5KB, champs obligatoires
    match /quotes/{document=**} {
      allow create: if request.resource.size < 5120 &&
                       request.resource.data.keys().hasAll(['name', 'email', 'message', 'createdAt']) &&
                       request.resource.data.name is string &&
                       request.resource.data.email is string &&
                       request.resource.data.message is string &&
                       request.resource.data.name.size() > 0 &&
                       request.resource.data.email.size() > 5 &&
                       request.resource.data.message.size() > 10;
      allow read, update, delete: if request.auth != null;  // Admin authentifié seulement
    }
  }
}
